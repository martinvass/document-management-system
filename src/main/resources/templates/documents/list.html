<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="hu">
<head th:replace="~{fragments/header :: html_header(title='DMS - Documents', additionalLinks=~{this::page_links})}">
    <th:block th:fragment="page_links">
        <link rel="stylesheet" th:href="@{/css/dashboard.css}">
        <link rel="stylesheet" th:href="@{/css/home.css}">
        <style>
            :root {
                --bg: #FEFAE0;
                --card: #E9E3C4;
                --accent: #5F6F52;
                --text: #2B2B2B;
                --radius: 12px;
                --shadow: 0 2px 8px rgba(0,0,0,0.08);
                --shadow-hover: 0 4px 16px rgba(0,0,0,0.12);

                --color-blue: #DCEBFF;
                --color-green: #dff5e1;
            }
            body {
                background: var(--bg);
                color: var(--text);
            }

            .upload-btn {
                background: var(--color-blue);
                color: var(--accent);
                border: none;
                padding: 16px;
                border-radius: 20%;
                font-weight: 600;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
                transition: all 0.3s;
                box-shadow: var(--shadow);
                width: 56px;
                height: 56px;
                font-size: 1.5rem;
            }
            .upload-btn:hover {
                background: #C1D0E3;
                box-shadow: var(--shadow-hover);
                transform: translateY(-2px) scale(1.05);
            }

            .filter-bar {
                background: var(--card);
                border-radius: var(--radius);
                padding: 16px 20px;
                margin-bottom: 24px;
                box-shadow: var(--shadow);
                display: flex;
                gap: 16px;
                align-items: center;
            }
            .filter-input {
                flex: 1;
                border: 1px solid rgba(95, 111, 82, 0.2);
                border-radius: var(--radius);
                padding: 10px 16px;
                font-size: 0.95rem;
            }
            .filter-input:focus {
                outline: none;
                border-color: var(--accent);
                box-shadow: 0 0 0 3px rgba(95, 111, 82, 0.1);
            }

            .doc-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
                gap: 20px;
            }
            .doc-card {
                background: var(--card);
                border-radius: var(--radius);
                padding: 20px;
                box-shadow: var(--shadow);
                transition: all 0.3s;
                cursor: pointer;
                position: relative;
                display: flex;
                flex-direction: column;
            }
            .doc-card:hover {
                box-shadow: var(--shadow-hover);
                transform: translateY(-4px);
            }
            .doc-icon {
                width: 56px;
                height: 56px;
                background: var(--accent);
                border-radius: 10px;
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-size: 28px;
                margin-bottom: 16px;
                transition: all 0.3s;
            }
            .doc-card:hover .doc-icon {
                transform: scale(1.05);
            }
            .doc-header {
                margin-bottom: 12px;
            }
            .doc-name {
                font-weight: 600;
                font-size: 1.05rem;
                color: var(--accent);
                margin-bottom: 6px;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }
            .doc-description {
                font-size: 0.9rem;
                color: var(--text);
                opacity: 0.75;
                margin-bottom: 12px;
                display: -webkit-box;
                -webkit-line-clamp: 2;
                -webkit-box-orient: vertical;
                overflow: hidden;
                min-height: 42px;
                line-height: 1.5;
            }
            .doc-meta {
                display: flex;
                gap: 12px;
                font-size: 0.85rem;
                opacity: 0.6;
                margin-bottom: 16px;
            }
            .doc-meta-item {
                display: flex;
                align-items: center;
                gap: 4px;
            }
            .doc-version-badge {
                display: inline-block;
                background: var(--color-green);
                color: var(--accent);
                padding: 4px 10px;
                border-radius: 6px;
                font-size: 0.75rem;
                font-weight: 600;
            }
            .doc-actions {
                display: flex;
                gap: 8px;
                margin-top: auto;
                padding-top: 16px;
                border-top: 1px solid rgba(0,0,0,0.08);
            }
            .icon-btn {
                background: transparent;
                border: 1px solid var(--accent);
                color: var(--accent);
                padding: 8px 12px;
                border-radius: 8px;
                cursor: pointer;
                transition: all 0.2s;
                display: flex;
                align-items: center;
                gap: 6px;
                font-size: 0.9rem;
                font-weight: 600;
                text-decoration: none;
            }
            .icon-btn:hover {
                background: var(--accent);
                color: white;
            }
            .icon-btn-primary {
                background: var(--accent);
                color: white;
                border: none;
            }
            .icon-btn-primary:hover {
                background: #4a5a41;
            }
            .icon-btn-circle {
                background: transparent;
                border: 1px solid var(--accent);
                color: var(--accent);
                padding: 10px;
                border-radius: 20%;
                cursor: pointer;
                transition: all 0.2s;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 1rem;
                text-decoration: none;
                width: 40px;
                height: 40px;
            }
            .icon-btn-circle:hover {
                background: #C1D0E3;
                color: white;
                transform: scale(1.1);
            }
            .icon-btn-circle.icon-btn-primary {
                background: var(--color-blue);
                color: var(--accent);
                border: none;
            }
            .icon-btn-circle.icon-btn-primary:hover {
                background: #C1D0E3;
            }

            .icon-btn-circle:disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }
            .icon-btn-circle:disabled:hover {
                background: transparent;
                color: var(--accent);
                transform: none;
            }

            .empty-state {
                text-align: center;
                padding: 80px 20px;
            }

            .empty-text {
                font-size: 1.1rem;
                opacity: 0.5;
                margin-bottom: 24px;
            }

            .modal {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                backdrop-filter: blur(4px);
                z-index: 1000;
                align-items: center;
                justify-content: center;
            }

            .modal.active {
                display: flex;
            }

            .modal-content {
                background: var(--card);
                border-radius: var(--radius);
                padding: 32px;
                max-width: 500px;
                width: 90%;
                box-shadow: 0 8px 32px rgba(0,0,0,0.2);
                animation: modalSlideIn 0.3s ease;
            }
            @keyframes modalSlideIn {
                from {
                    opacity: 0;
                    transform: translateY(-20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
            .modal-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 24px;
            }
            .modal-title {
                font-size: 1.5rem;
                font-weight: 700;
                color: var(--accent);
            }
            .modal-close {
                background: none;
                border: none;
                font-size: 1.5rem;
                cursor: pointer;
                color: var(--text);
                opacity: 0.6;
                transition: opacity 0.2s;
            }
            .modal-close:hover {
                opacity: 1;
            }
            .form-group {
                margin-bottom: 20px;
            }
            .form-label {
                display: block;
                font-weight: 600;
                margin-bottom: 8px;
                color: var(--text);
            }
            .form-control {
                width: 100%;
                border: 1px solid rgba(95, 111, 82, 0.2);
                border-radius: var(--radius);
                padding: 12px 16px;
                font-size: 0.95rem;
            }
            .form-control:focus {
                outline: none;
                border-color: var(--accent);
                box-shadow: 0 0 0 3px rgba(95, 111, 82, 0.1);
            }
            .file-input-wrapper {
                position: relative;
                overflow: hidden;
                display: inline-block;
                width: 100%;
            }
            .file-input-label {
                background: var(--bg);
                border: 2px dashed var(--accent);
                border-radius: var(--radius);
                padding: 40px 20px;
                text-align: center;
                cursor: pointer;
                transition: all 0.2s;
                display: block;
            }
            .file-input-label:hover {
                background: #f5f1d8;
            }
            .file-input-label i {
                font-size: 2.5rem;
                color: var(--accent);
                margin-bottom: 12px;
            }
            .file-input {
                position: absolute;
                opacity: 0;
                cursor: pointer;
            }
            .alert {
                border-radius: var(--radius);
                margin-bottom: 20px;
            }
        </style>
    </th:block>
</head>
<body>
<nav th:replace="~{fragments/dashboard/navigation :: navigation_bar}"></nav>
<div th:replace="~{fragments/dashboard/sidebar :: sidebar(content=~{::content})}">
    <div th:fragment="content" class="container-fluid py-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="fw-bold m-0">Documents</h3>
            <button class="upload-btn" onclick="openUploadModal()" title="Upload document">
                <i class="fa-solid fa-upload"></i>
            </button>
        </div>

        <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
        <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

        <div class="filter-bar">
            <i class="fa-solid fa-magnifying-glass" style="color: var(--accent); font-size: 1.1rem;"></i>
            <input type="text"
                   class="filter-input"
                   id="searchInput"
                   placeholder="Search documents by name or description..."
                   onkeyup="filterDocuments()">
        </div>

        <div th:if="${#lists.isEmpty(documents)}" class="empty-state">
            <div class="empty-text">No documents yet</div>
        </div>

        <div class="doc-grid" id="docGrid" th:unless="${#lists.isEmpty(documents)}">
            <div th:each="doc : ${documents}"
                 class="doc-card"
                 th:attr="data-name=${doc.originalFilename}, data-desc=${doc.description}, data-id=${doc.id}"
                 onclick="viewDocument(this)">

                <div class="doc-icon">
                    <i th:class="${doc.getIconClass()}"></i>
                </div>

                <div class="doc-header">
                    <div class="doc-name" th:text="${doc.originalFilename}">document.pdf</div>
                    <span class="doc-version-badge" th:text="'v' + ${doc.version}">v1</span>
                </div>

                <div class="doc-description" th:text="${doc.description ?: 'No description'}">
                    Document description here...
                </div>

                <div class="doc-meta">
                    <div class="doc-meta-item">
                        <span th:text="${doc.uploadedBy.username}">User</span>
                    </div>
                    <div class="doc-meta-item">
                        <span th:text="${#temporals.format(doc.uploadedAt, 'MMM dd')}">Jan 15</span>
                    </div>
                    <div class="doc-meta-item">
                        <span th:text="${#numbers.formatDecimal(doc.size / 1024.0, 1, 2)} + ' KB'">125.50 KB</span>
                    </div>
                </div>

                <div class="doc-actions" onclick="event.stopPropagation()">
                    <a th:href="@{/documents/{id}/download(id=${doc.id})}"
                       class="icon-btn-circle icon-btn-primary"
                       title="Download">
                        <i class="fa-solid fa-download"></i>
                    </a>
                    <button class="icon-btn-circle icon-btn-primary" title="Share">
                        <i class="fa-solid fa-share"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="uploadModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h4 class="modal-title">Upload Document</h4>
            <button class="modal-close" onclick="closeUploadModal()">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </div>
        <form th:action="@{/documents/upload}" method="post" enctype="multipart/form-data">
            <div class="form-group">
                <label class="form-label">File</label>
                <div class="file-input-wrapper">
                    <label for="fileInput" class="file-input-label">
                        <span id="fileName">Click to select a file</span>
                    </label>
                    <input type="file"
                           id="fileInput"
                           name="file"
                           class="file-input"
                           required
                           onchange="updateFileName(this)">
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Description (optional)</label>
                <textarea name="description"
                          class="form-control"
                          rows="4"
                          placeholder="Enter a description for this document..."></textarea>
            </div>
            <div class="d-flex gap-2">
                <button type="submit" class="icon-btn" style="padding: 12px 24px;">
                    Upload
                </button>
                <button type="button"
                        class="icon-btn"
                        onclick="closeUploadModal()"
                        style="padding: 12px 24px;">
                    Cancel
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    function viewDocument(card) {
        const docId = card.getAttribute('data-id');
        window.location.href = '/documents/' + docId;
    }

    function openUploadModal() {
        document.getElementById('uploadModal').classList.add('active');
    }

    function closeUploadModal() {
        document.getElementById('uploadModal').classList.remove('active');
        document.getElementById('fileInput').value = '';
        document.getElementById('fileName').textContent = 'Click to select a file';
    }

    function updateFileName(input) {
        const fileName = input.files[0]?.name || 'Click to select a file';
        document.getElementById('fileName').textContent = fileName;
    }

    function filterDocuments() {
        const searchValue = document.getElementById('searchInput').value.toLowerCase();
        const cards = document.querySelectorAll('.doc-card');

        cards.forEach(card => {
            const name = card.getAttribute('data-name')?.toLowerCase() || '';
            const desc = card.getAttribute('data-desc')?.toLowerCase() || '';

            if (name.includes(searchValue) || desc.includes(searchValue)) {
                card.style.display = '';
            } else {
                card.style.display = 'none';
            }
        });
    }

    document.getElementById('uploadModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeUploadModal();
        }
    });
</script>

<div th:replace="~{fragments/scripts :: footer_scripts}"></div>
</body>
</html>